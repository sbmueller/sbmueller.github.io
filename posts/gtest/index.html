<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://sbmueller.de/ name=base><title>
            
                What I learned: Google Test
            
        </title><meta content="What I learned: Google Test" property=og:title><link href=https://sbmueller.de/icon/favicon.png rel=icon type=image/png><link href=https://sbmueller.de/fonts.css rel=stylesheet><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://sbmueller.de/theme/light.css rel=stylesheet><link href=https://sbmueller.de/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://sbmueller.de/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://sbmueller.de/main.css media=screen rel=stylesheet><body><div class=left-content></div><div class=content><style>.avatar{vertical-align:middle;border-radius:50%;max-width:150px;height:auto}#wrapper{clear:both;text-align:center;width:100%}</style><nav><div class=left-nav><a href=https://sbmueller.de/>sbmueller</a><div class=socials><a class=social href=https://github.com/sbmueller/ rel=me> <img alt=github src=https://sbmueller.de/icons/social/github.svg> </a><a class=social href=https://www.linkedin.com/in/sbmueller/ rel=me> <img alt=linkedin src=https://sbmueller.de/icons/social/linkedin.svg> </a></div></div><div class=right-nav><a href=https://sbmueller.de/about style=margin-right:.5em>/about</a><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://sbmueller.de/icons/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://sbmueller.de/icons/moon.svg> </a><script>updateItemToggleTheme()</script></div></nav><div id=wrapper><a href=https://sbmueller.de/> <img src="https://avatars.githubusercontent.com/u/7465688?v=4" class=avatar> </a></div><div data-selector="main article p" class=visible-element-observer-root><main><article><div class=title><div class=page-header>What I learned: Google Test</div><div class=meta>Posted on <time>2018-10-27</time></div></div><section class=body><p>I have tackled a small C++ project recently for an interview process and used the chance to learn more about testing. I have mostly used Python <code>unittest</code> in the past, both for Python and C code. Together with <code>ctypes</code> it is a nice solution to test C against Python code.<p>Now I wanted to have a deeper look into Google Test in combination with CMake.<h2 id=setting-up-google-test>Setting up Google Test</h2><p>I compiled Google Test myself, which is pretty easy with the repo on <a href=https://github.com/google/googletest rel=external>Github</a>. This will install headers and libraries necessary for C++ testing in your projects.<p>An easy example of how to use Google Test can be found <a href=https://gist.github.com/mawenbao/9223908 rel=external>here</a>. I use one single source file to run all my tests:<pre class=giallo style=color:#e0def4;background-color:#232136><code data-lang=cpp><span class=giallo-l><span style=color:#908caa>#</span><span style=color:#3e8fb0>include</span><span style=color:#f6c177> &lt;gtest/gtest.h></span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#3e8fb0>int</span><span style=color:#ea9a97> main</span><span style=color:#908caa>(</span><span style=color:#3e8fb0>int</span><span style=color:#c4a7e7;font-style:italic> argc</span><span style=color:#908caa>,</span><span style=color:#3e8fb0> char **</span><span style=color:#c4a7e7;font-style:italic>argv</span><span style=color:#908caa>) {</span></span>
<span class=giallo-l><span>    ::</span><span style=color:#ea9a97>testing</span><span style=color:#908caa>::</span><span style=color:#ea9a97>InitGoogleTest</span><span style=color:#908caa>(</span><span style=color:#3e8fb0>&</span><span>argc</span><span style=color:#908caa>,</span><span> argv</span><span style=color:#908caa>);</span></span>
<span class=giallo-l><span style=color:#3e8fb0>    return</span><span style=color:#ea9a97> RUN_ALL_TESTS</span><span style=color:#908caa>();</span></span>
<span class=giallo-l><span style=color:#908caa>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#3e8fb0>const char *</span><span>actualValTrue  </span><span style=color:#3e8fb0>=</span><span style=color:#f6c177> "hello gtest"</span><span style=color:#908caa>;</span></span>
<span class=giallo-l><span style=color:#3e8fb0>const char *</span><span>expectVal      </span><span style=color:#3e8fb0>=</span><span style=color:#f6c177> "hello gtest"</span><span style=color:#908caa>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#ea9a97>TEST</span><span style=color:#908caa>(</span><span>StrCompare</span><span style=color:#908caa>,</span><span> CStrEqual</span><span style=color:#908caa>) {</span></span>
<span class=giallo-l><span style=color:#ea9a97>    EXPECT_STREQ</span><span style=color:#908caa>(</span><span>expectVal</span><span style=color:#908caa>,</span><span> actualValTrue</span><span style=color:#908caa>);</span></span>
<span class=giallo-l><span style=color:#908caa>}</span></span></code></pre><h2 id=integrate-gtest-in-cmake>Integrate GTest in CMake</h2><p>I wanted a solution to work together with CMake. When I run <code>make test</code> it should run the GTest tests and report the results. Also, I wanted the tests to be ignored if GTest is not available on a machine. I came up with this CMakeLists.txt.<pre class=giallo style=color:#e0def4;background-color:#232136><code data-lang=cmake><span class=giallo-l><span style=color:#3e8fb0>cmake_minimum_required</span><span>(VERSION 3.9)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>project</span><span>(test_with_gtest)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>add_library</span><span>(test_with_gtest SHARED code_to_be_tested.cpp)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>find_package</span><span>(GTest)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>if</span><span>(${GTEST_FOUND})</span></span>
<span class=giallo-l><span style=color:#3e8fb0>    message</span><span>(</span><span style=color:#f6c177>"GTest found, enabling testing"</span><span>)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>    enable_testing</span><span>()</span></span>
<span class=giallo-l><span style=color:#3e8fb0>    add_subdirectory</span><span>(</span><span style=color:#3e8fb0>test</span><span>)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>endif</span><span>(${GTEST_FOUND})</span></span></code></pre><p>This will build a shared library with name <code>test_with_gtest</code> based on the source file <code>code_to_be_tested.cpp</code>. If Google Test is installed/found, additionally, the <code>test</code> directory is added to the project and testing is enabled. The <code>CMakeLists.txt</code> of the <code>test</code> folder looks like this.<pre class=giallo style=color:#e0def4;background-color:#232136><code data-lang=cmake><span class=giallo-l><span style=color:#3e8fb0>include</span><span>(GoogleTest)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>add_executable</span><span>(google_tests test_cases.cpp)</span></span>
<span class=giallo-l><span style=color:#3e8fb0>include_directories</span><span>(${CMAKE_BINARY_DIR} ${gtest_SOURCE_DIR}/include ${gtest_SOURCE_DIR})</span></span>
<span class=giallo-l><span style=color:#3e8fb0>target_link_libraries</span><span>(google_tests gtest gtest_main test_with_gtest)</span></span>
<span class=giallo-l><span>gtest_add_tests(</span><span style=color:#3e8fb0>TARGET</span><span> google_tests AUTO)</span></span></code></pre><p>This creates a new executable target <code>google_tests</code> from source file <code>test_cases.cpp</code> (see first code section). This code links against the library which contains the code to be tested.<p>Now, if Google Test is found, I can compile my project and run tests like this.<pre class=giallo style=color:#e0def4;background-color:#232136><code data-lang=shellscript><span class=giallo-l><span style=color:#ea9a97>$</span><span style=color:#f6c177> cmake ..</span></span>
<span class=giallo-l><span style=color:#ea9a97>$</span><span style=color:#f6c177> make</span><span style=color:#3e8fb0> -j4</span></span>
<span class=giallo-l><span style=color:#ea9a97>$</span><span style=color:#f6c177> make test</span></span></code></pre><p>However, this is just a CMake summary of the tests. If something goes wrong, it is nice to have a more verbose output by directly running the executable performing the tests.<pre class=giallo style=color:#e0def4;background-color:#232136><code data-lang=shellscript><span class=giallo-l><span style=color:#ea9a97>$</span><span style=color:#f6c177> ./test/google_tests</span></span></code></pre><h2 id=test-fixtures>Test Fixtures</h2><p>For more extensive testing, it is preferrable to use reproducable sets of input data. This is where fixtures come in handy. A fixture is a class providing logic to prepare (<code>SetUp()</code>) and clean up (<code>TearDown()</code>) tests. This logic gets called before each test and enables multiple tests on the same input state. An example can be<pre class=giallo style=color:#e0def4;background-color:#232136><code data-lang=cpp><span class=giallo-l><span style=color:#908caa>#</span><span style=color:#3e8fb0>include</span><span style=color:#f6c177> &lt;gtest/gtest.h></span></span>
<span class=giallo-l><span style=color:#908caa>#</span><span style=color:#3e8fb0>include</span><span style=color:#f6c177> "../code_to_be_tested.h"</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#3e8fb0>int</span><span> factor</span><span style=color:#908caa>;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#3e8fb0>class</span><span style=color:#9ccfd8> rangeAllocatorTests</span><span style=color:#908caa>:</span><span style=color:#3e8fb0> public</span><span style=color:#908caa> ::</span><span style=color:#ea9a97>testing</span><span style=color:#908caa>::</span><span style=color:#9ccfd8>Test</span><span style=color:#908caa> {</span></span>
<span class=giallo-l><span style=color:#3e8fb0>  protected</span><span style=color:#908caa>:</span></span>
<span class=giallo-l><span style=color:#3e8fb0>    void</span><span style=color:#ea9a97> SetUp</span><span style=color:#908caa>() {</span></span>
<span class=giallo-l><span>        factor </span><span style=color:#3e8fb0>=</span><span style=color:#ea9a97> 7</span><span style=color:#908caa>;</span></span>
<span class=giallo-l><span style=color:#908caa>    }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#3e8fb0>    void</span><span style=color:#ea9a97> TearDown</span><span style=color:#908caa>() {</span></span>
<span class=giallo-l><span style=color:#908caa>    }</span></span>
<span class=giallo-l><span style=color:#908caa>};</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#3e8fb0>int</span><span style=color:#ea9a97> main</span><span style=color:#908caa>(</span><span style=color:#3e8fb0>int</span><span style=color:#c4a7e7;font-style:italic> argc</span><span style=color:#908caa>,</span><span style=color:#3e8fb0> char **</span><span style=color:#c4a7e7;font-style:italic>argv</span><span style=color:#908caa>) {</span></span>
<span class=giallo-l><span>  ::</span><span style=color:#ea9a97>testing</span><span style=color:#908caa>::</span><span style=color:#ea9a97>InitGoogleTest</span><span style=color:#908caa>(</span><span style=color:#3e8fb0>&</span><span>argc</span><span style=color:#908caa>,</span><span> argv</span><span style=color:#908caa>);</span></span>
<span class=giallo-l><span style=color:#3e8fb0>  return</span><span style=color:#ea9a97> RUN_ALL_TESTS</span><span style=color:#908caa>();</span></span>
<span class=giallo-l><span style=color:#908caa>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span style=color:#ea9a97>TEST_F</span><span style=color:#908caa>(</span><span>rangeAllocatorTests</span><span style=color:#908caa>,</span><span> testAddition</span><span style=color:#908caa>) {</span></span>
<span class=giallo-l><span style=color:#3e8fb0>  int</span><span> result </span><span style=color:#3e8fb0>=</span><span style=color:#ea9a97> 4</span><span style=color:#3e8fb0> *</span><span> factor</span><span style=color:#908caa>;</span></span>
<span class=giallo-l><span style=color:#ea9a97>  EXPECT_EQ</span><span style=color:#908caa>(</span><span>result</span><span style=color:#908caa>,</span><span style=color:#ea9a97> 28</span><span style=color:#908caa>);</span></span>
<span class=giallo-l><span style=color:#908caa>}</span></span></code></pre><p>With this code, <code>factor</code> will always be set to <code>7</code> before the actual test happens. Of course, this is a very simple example and in most cases you want to have a more complex <code>SetUp()</code> routine.</section></article></main></div><hr><center><small>Copyright © 2026 Sebastian Müller. All rights reserved.</small></center></div><div class=right-content></div>